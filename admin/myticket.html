<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
       "http://www.w3.org/TR/html4/loose.dtd">

<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="http://getbootstrap.com/favicon.ico">

    <title>Meine Tickets</title>

    <!-- Bootstrap core CSS -->
    <link href="dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="dist/css/bootstrap-select.css" rel="stylesheet">
    <!-- Custom styles for this template -->
    <link href="css/template.css" rel="stylesheet">
    <script src="js/jquery-1.11.1.min.js"></script>
    <script src="dist/js/bootstrap-select.js"></script>

    <!-- Just for debugging purposes. Don't actually copy these 2 lines! -->
    <!--[if lt IE 9]><script src="../../assets/js/ie8-responsive-file-warning.js"></script><![endif]-->
    <script src="dist/js/ie-emulation-modes-warning.js"></script><style type="text/css"></style>

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>

  <body>

    <div  id="myModal" class="modal fade">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            <h4 class="modal-title">Ticket Details</h4>
          </div>
          <div class="modal-body">           

           
            

            <div class="row">
              <div class="col-md-6 lead"><span>Produktion: </span><span id="produktion">Test</span></div>
              <div class="col-md-6 lead"><span>Datum: </span><span id="datum">14.07.2014</span></div>
            </div>
             

             <div class="row">
              <div class="col-md-6 lead"><span>Grund: </span><span id="grund">Video</span></div>
              <div class="col-md-6 lead"><span>Raum: </span><span id="raum">Atelier 1</span></div>
            </div> 

            <p>Benutzer Text<p>
            <textarea id="user_text" class="form-control" rows="3"readonly></textarea>
            <p>Administrator Text<p>
            <textarea id="admin_text" class="form-control" rows="3"readonly></textarea>
            


          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Schliessen</button>
            
          </div>
        </div><!-- /.modal-content -->
      </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->

    <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <span id="name_brand" class="navbar-brand" ></span>
        </div>
        <div id="navbar" class="collapse navbar-collapse">
          <ul class="nav navbar-nav">
            <li class="active"><a href="ticket.php">Neues Ticket</a></li>
            <li><a href="assets/logout.php">Logout</a></li>         
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container">
      <div class="starter-template">
        <h2>Meine Tickets</h2>
        <div class="panel panel-default">
          <div class="panel-body">
            <div id="search_button_area">
              <button id="button_all" class="btn btn-info btn-xs" type="button" data-toggle="button">
                alle <span id="badge_open" class="badge">4</span>
              </button>
              <button id="button_open" class="btn btn-default btn-xs" type="button" data-toggle="button">
                offen <span id="badge_open" class="badge">4</span>
              </button>
               <button id="button_busy" class="btn btn-default btn-xs" type="button">
                in Bearb. <span id="badge_busy" class="badge">10</span>
              </button>
               <button id="button_closed" class="btn btn-default btn-xs" type="button">
                geschl. <span id="badge_closed" class="badge">3</span>
              </button>
            </div>
            <div id="search_ticket_area" class="input-group">
                <input type="text" class="form-control" id="search-ticket" placeholder="Tickets suchen...">
                <div id="search_reset" title="Suche lÃ¶schen" class="input-group-addon">  <span  class="glyphicon glyphicon-remove-sign"></span> </div>
            </div>
          </div>
        </div>  


        <script>

            $('#button_all').click(function(){            
                $('#button_all').removeClass("btn-default");
                $('#button_all').addClass("btn-info");

                $('#button_open').removeClass("btn-danger");
                $('#button_open').addClass("btn-default");

                $('#button_busy').removeClass("btn-warning");
                $('#button_busy').addClass("btn-default");

                $('#button_closed').removeClass("btn-success");
                $('#button_closed').addClass("btn-default");
            });

             $('#button_open').click(function(){            
                $('#button_all').removeClass("btn-info");
                $('#button_all').addClass("btn-default");

                $('#button_open').removeClass("btn-default");
                $('#button_open').addClass("btn-danger");

                $('#button_busy').removeClass("btn-warning");
                $('#button_busy').addClass("btn-default");

                $('#button_closed').removeClass("btn-success");
                $('#button_closed').addClass("btn-default");
            });

            $('#button_busy').click(function(){            
              $('#button_all').removeClass("btn-info");
              $('#button_all').addClass("btn-default");

              $('#button_open').removeClass("btn-danger");
              $('#button_open').addClass("btn-default");

              $('#button_busy').removeClass("btn-default");
              $('#button_busy').addClass("btn-warning");

              $('#button_closed').removeClass("btn-success");
              $('#button_closed').addClass("btn-default");
            });

             $('#button_closed').click(function(){            
              $('#button_all').removeClass("btn-info");
              $('#button_all').addClass("btn-default");

              $('#button_open').removeClass("btn-danger");
              $('#button_open').addClass("btn-default");

              $('#button_busy').removeClass("btn-warning");
              $('#button_busy').addClass("btn-default");

              $('#button_closed').removeClass("btn-default");
              $('#button_closed').addClass("btn-success");
            });









          $('#search-ticket').keyup(function(){
            var search_value = $('#search-ticket').val();
            filter_table(search_value);                                               
          });                      
          

          $('#search_reset').click(function(){            
            $('#search-ticket').val("");
            build_table();                                               
          });

         </script>

        <div class="panel panel-default">
        <div class="panel-body">
          <div class="table-responsive">
            <table id="ticket_table" class="table table-hover">
              <tr>
                <th class="col-sm-1">#</th>
                <th class="col-sm-2">Datum</th>
                <th class="col-sm-1">Uhrzeit</th>
                <th class="col-sm-2">Raum</th>
                <th class="col-sm-2">Grund</th>
                <th class="col-sm-4">Fehler</th>
              <tr>
            </table>
          </div>  
         <nav>
            <ul class="pagination pagination-sm">
              <li id="prev_page"><a href="#">&laquo;</a></li>               
            </ul>
          </nav>

          </div>
        </div>
       
      </div>
    </div><!-- /.container -->

  <script> 

  function activate_paging_click() {

    $("#prev_page").click(function() {
      prev_page();
     
    });

    $("#next_page").click(function() {
      next_page();
      
    });

    $(".paging").click(function() {
      var id=$(this).attr("id");
      id=id.split("_");
      change_page(id[1]);      
    });

    $("#prev_page_filter").click(function() {
      prev_page_filter();
     
    });

    $("#next_page_filter").click(function() {
      next_page_filter();
      
    });

    $(".paging_filter").click(function() {
      var id=$(this).attr("id");
      id=id.split("_");
      change_page_filter(id[1]);      
    });

  }
    

  </script>

    <script>  

      var obj;

      function next_page() {       

        max_index=0;


        $('.paging').each(function(index) {
            max_index=max_index+1;
            $(this).removeClass("active");

        });    



        if (current_page<max_index) {
          current_page=current_page+1;
        }

        $('.paging').each(function(index) {
          
            if ((index+1)==current_page) {
              $(this).addClass("active");             
            }

        });  
      build_table();    

      }

      function prev_page() {
        max_index=0;

        $('.paging').each(function(index) {
            max_index=max_index+1;
            $(this).removeClass("active");
        });

        if (current_page>1) {
          current_page=current_page-1;
        }

         $('.paging').each(function(index) {
          
            if ((index+1)==current_page) {
              $(this).addClass("active");
            }
                        
        });  
        build_table(); 
       
        
      }

      function change_page(id) {
        max_index=0;

        $('.paging').each(function(index) {
            max_index=max_index+1;
            $(this).removeClass("active");
        });       
        
       $('#i_'+id).addClass("active");
       current_page=parseInt(id); 
       build_table();
      }




      function next_page_filter() {       

        max_index=0;

        $('.paging_filter').each(function(index) {
            max_index=max_index+1;
            $(this).removeClass("active");
        });    



        if (current_page<max_index) {
          current_page=current_page+1;
        }

        $('.paging_filter').each(function(index) {
          
            if ((index+1)==current_page) {
              $(this).addClass("active");             
            }

        });  
        build_table_filter(filter_obj);     

      }

      function prev_page_filter() {
        max_index=0;

        $('.paging').each(function(index) {
            max_index=max_index+1;
            $(this).removeClass("active");
        });

        if (current_page>1) {
          current_page=current_page-1;
        }

         $('.paging_filter').each(function(index) {
          
            if ((index+1)==current_page) {
              $(this).addClass("active");
            }
                        
        });  
        build_table_filter(filter_obj);       
        
      }

      function change_page_filter(id) {
        max_index=0;

        $('.paging_filter').each(function(index) {
            max_index=max_index+1;
            $(this).removeClass("active");
        });       
        
       $('#i_'+id).addClass("active");
       current_page=parseInt(id); 
        build_table_filter(filter_obj);

      }

      var current_page;

      $(document).ready(function () {

            current_page = 1;

            $('.selectpicker').selectpicker();

            var cookie = document.cookie;         
            var username;
            var cookie_elements=cookie.split(";");         

            for (x=0;x<cookie_elements.length;x++) {

              var atom = cookie_elements[x].split("=");

              if (atom[0].trim()=="username") {
               
                username=atom[1];
              }

              if (atom[0].trim()=="vorname") {
                
                var vorname=atom[1];
              }

              if (atom[0].trim()=="nachname") {
               
                var nachname=atom[1]
              }
            }

            $("#name_brand").empty();
            $("#name_brand").append(vorname+" "+nachname);

            get_ticket(username);
      });

      function build_table() {

        $(".pagination").empty();

        $(".pagination").append("<li id='prev_page'><a href='#''>&laquo;</a></li>");      

          for (x=1;x<=(Math.floor(obj.length/10)+1);x++) {
             
            $(".pagination").append("<li id='i_"+x+"' class='paging'><a href='#''>"+x+"</a></li>")

          }

        $(".pagination").append("<li id='next_page'><a href='#''>&raquo;</a></li>")
        
        $("#i_"+current_page).addClass("active");

        activate_paging_click();

        $(".tablerow").remove();

        var count_open=0;
        var count_busy=0;
        var count_closed=0;

        max_page = current_page*10;

        if (obj.length<max_page) {
          max_page=obj.length;
        }

        for  (x=((current_page*10)-9);x<=max_page;x++) {

           $("#ticket_table").append("<tr class='tablerow' id='"+obj[x-1].id+"''><td>"+obj[x-1].id+"</td><td>"+obj[x-1].datum+"</td><td>"+obj[x-1].zeit+"</td><td>"+obj[x-1].raum+"</td><td>"+obj[x-1].grund+"</td><td>"+obj[x-1].text_user+"</td></tr>");

                if (obj[x-1].status==0) {
                     count_open=count_open+1;
                     $("#"+obj[x-1].id).addClass("danger");
                }

                 if (obj[x-1].status==1) {
                     count_busy=count_busy+1;
                     $("#"+obj[x-1].id).addClass("warning");
                }

                 if (obj[x-1].status==2) {
                     count_closed=count_closed+1;
                     $("#"+obj[x-1].id).addClass("success");
                }             
        } 
      }


      function filter_table(search_value) { 

        var filter_obj = [];     

        for (x=0;x<obj.length;x++) {           

            var result_ticket_room = obj[x].raum.search(new RegExp( search_value, 'i' ));

            if (result_ticket_room > -1) {
             
              filter_obj[filter_obj.length]=obj[x];

            }
        }

        build_filter_table(filter_obj);

      }

      function build_filter_table(filter_obj) {        

        $(".pagination").empty();

        $(".pagination").append("<li id='prev_page_filter'><a href='#''>&laquo;</a></li>");      

          for (x=1;x<=(Math.floor(filter_obj.length/10)+1);x++) {
             
            $(".pagination").append("<li id='i_"+x+"' class='paging_filter'><a href='#''>"+x+"</a></li>")

          }

        $(".pagination").append("<li id='next_page_filter'><a href='#''>&raquo;</a></li>")
        $("#i_1").addClass("active");

        $(".tablerow").remove();

        var count_open=0;
        var count_busy=0;
        var count_closed=0;

        max_page = current_page*10;

        if (filter_obj.length<max_page) {
          max_page=filter_obj.length;
        }

        for  (x=((current_page*10)-9);x<=max_page;x++) {

           $("#ticket_table").append("<tr class='tablerow' id='"+filter_obj[x-1].id+"''><td>"+filter_obj[x-1].id+"</td><td>"+filter_obj[x-1].datum+"</td><td>"+filter_obj[x-1].zeit+"</td><td>"+filter_obj[x-1].raum+"</td><td>"+filter_obj[x-1].grund+"</td><td>"+filter_obj[x-1].text_user+"</td></tr>");

                if (obj[x-1].status==0) {
                     count_open=count_open+1;
                     $("#"+filter_obj[x-1].id).addClass("danger");
                }

                 if (obj[x-1].status==1) {
                     count_busy=count_busy+1;
                     $("#"+filter_obj[x-1].id).addClass("warning");
                }

                 if (obj[x-1].status==2) {
                     count_closed=count_closed+1;
                     $("#"+filter_obj[x-1].id).addClass("success");
                }             
        } 

      activate_paging_click();


      }



      function get_ticket(username) {

        var count_open=0;
        var count_busy=0;
        var count_closed=0;

        $.ajax({
                url: "assets/mytickets_all.php",
                type: "POST",
                data: {
                    username: username                   
                    
                },
                success: function(response)
                {  
                   obj = jQuery.parseJSON( response );

                   for (x=1;x<=(Math.floor(obj.length/10)+1);x++) {
                     
                      $(".pagination").append("<li id='i_"+x+"' class='paging'><a href='#''>"+x+"</a></li>")

                   }

                   $(".pagination").append("<li id='next_page'><a href='#''>&raquo;</a></li>")
                   $("#i_1").addClass("active");

                   activate_paging_click();

                    $.each( obj, function( key, value ) {

                        if (key<10) {

                          $("#ticket_table").append("<tr class='tablerow' id='"+value.id+"''><td>"+value.id+"</td><td>"+value.datum+"</td><td>"+value.zeit+"</td><td>"+value.raum+"</td><td>"+value.grund+"</td><td>"+value.text_user+"</td></tr>");

                          if (value.status==0) {
                               count_open=count_open+1;
                               $("#"+value.id).addClass("danger");
                          }

                           if (value.status==1) {
                               count_busy=count_busy+1;
                               $("#"+value.id).addClass("warning");
                          }

                           if (value.status==2) {
                               count_closed=count_closed+1;
                               $("#"+value.id).addClass("success");
                          }             

                        }                                            

                    });





                    $("#badge_open").empty();
                    $("#badge_open").append(count_open);
                    $("#badge_busy").empty();
                    $("#badge_busy").append(count_busy);
                    $("#badge_closed").empty();
                    $("#badge_closed").append(count_closed);


                    $( ".tablerow" ).click(function() {
                            id=$( this ).attr("id");

                                  $.ajax({
                                    url: "assets/ticket_details.php",
                                    type: "POST",
                                    data: {
                                        ticket_id: id                   
                                        
                                    },
                                    success: function(response)
                                    {  
                                        var obj = jQuery.parseJSON( response );  
                                        
                                        if (obj.status == "0") {
                                          $(".modal-header").css('background-color','#f2dede');
                                          $(".modal-title").empty();
                                          $(".modal-title").append("Ticketnummer: "+obj.ticket_id+" | Status: offen");
                                        }

                                        if (obj.status == "1") {
                                        
                                          $(".modal-header").css('background-color','#fcf8e3');
                                          $(".modal-title").empty();
                                          $(".modal-title").append("Ticketnummer: "+obj.ticket_id+" | Status: in Bearbeitung");

                                        }

                                         if (obj.status == "2") {

                                          $(".modal-header").css('background-color','#dff0d8');
                                          $(".modal-title").empty();
                                          $(".modal-title").append("Ticketnummer: "+obj.ticket_id+" | Status: geschlossen");

                                        }


                                        $("#raum").empty();
                                        $("#grund").empty();
                                        $("#datum").empty();
                                        $("#produktion").empty();

                                        $("#raum").append(obj.raum);
                                        $("#grund").append(obj.grund);
                                        $("#datum").append(obj.datum);
                                        $("#produktion").append(obj.produktion);

                                        $("#user_text").val(obj.text_user);
                                        $("#admin_text").val(obj.text_admin);

                                        $("#myModal").modal("show");  

                                    }              

                              });
                    });

                }
            });        

      }

    </script>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    
    <script src="dist/js/bootstrap.min.js"></script>

    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="dist/js/ie10-viewport-bug-workaround.js"></script>
  

</body></html>